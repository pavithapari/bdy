<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>✨ Your Space Birthday ✨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #181e2a;
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .container { margin-top: 7vh; }
    #result-card {
      background: rgba(40,40,60,0.85);
      border-radius: 20px;
      box-shadow: 0 0 30px #2226;
      animation: fadeIn 1.2s;
      padding: 2em 1em;
      margin-top: 2em;
      border: 2px solid #7f7fd5;
    }
    @keyframes fadeIn {
      0% {opacity:0;transform:scale(0.95);}
      100% {opacity:1;transform:scale(1);}
    }
    #result-card img, #result-card .videoWrapper {
      max-width: 100%; border-radius: 14px; box-shadow: 0 0 25px #222;
    }
    #result-card h4 { margin-top: 1em; color: #fffa; text-shadow: 0 0 10px #7f7fd5;}
    #moon-phase {font-size: 2em;}
    .error { color: #f66; font-weight: bold; }
    .videoWrapper {position:relative; padding-bottom:56.25%; height:0;}
    .videoWrapper iframe {position:absolute;top:0;left:0;width:100%;height:100%;}
    .bday-anim {
      font-size: 2.5em; font-weight: bold; color: #ffe066; text-shadow: 0 0 18px #ff7f50, 0 0 50px #fff;
      animation: popIn 1.3s cubic-bezier(.51,.81,.45,1.17);
      margin-bottom: 1em;
      letter-spacing: 2px;
    }
    @keyframes popIn {
      0% {opacity:0;transform:scale(0.5);}
      80% {opacity:1;transform:scale(1.08);}
      100% {opacity:1;transform:scale(1);}
    }
    .glow-btn {
      box-shadow: 0 0 20px #7f7fd5, 0 0 40px #f7971e inset;
      animation: pulseBtn 2s infinite;
    }
    @keyframes pulseBtn {
      0% {box-shadow: 0 0 20px #7f7fd5, 0 0 40px #f7971e inset;}
      50% {box-shadow: 0 0 40px #7f7fd5, 0 0 60px #f7971e inset;}
      100% {box-shadow: 0 0 20px #7f7fd5, 0 0 40px #f7971e inset;}
    }
    #star-canvas {
      position: fixed; left:0; top:0; width:100vw; height:100vh; z-index:-1;
      pointer-events: none;
      display: block;
      background: transparent;
    }
    #audio-control {
      position: fixed;
      bottom: 25px; right: 25px;
      z-index: 2000;
      background: rgba(30,30,60,0.6);
      border-radius: 10px;
      padding: 8px 16px;
      color: #fff;
      box-shadow: 0 0 12px #222;
      font-size: 1.15em;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background 0.2s;
    }
    #audio-control:hover { background: #302b63; }
    .candle-emoji {
      font-size: 1.3em; 
      animation: flicker 1s infinite alternate;
      display: inline-block;
    }
    @keyframes flicker {
      0% { filter: brightness(1.1); transform: translateY(0);}
      80% { filter: brightness(1.4); transform: translateY(-2px);}
      100% { filter: brightness(0.9); transform: translateY(0);}
    }
  </style>
</head>
<body>
  <canvas id="star-canvas"></canvas>
  <div class="container text-center">
    <h1 class="mb-4" style="font-family: 'Trebuchet MS', cursive; font-size:2.5em;">
      <span style="color:#f7971e;">✨</span> Your Space Birthday <span style="color:#7f7fd5;">🚀</span>
    </h1>
    <div class="mb-3">
      <input type="date" id="birthday" class="form-control form-control-lg" max="2025-09-20">
    </div>
    <button id="go" class="btn btn-info btn-lg mb-4 glow-btn">Show Me The Cosmos!</button>
    <div id="result"></div>
    <p class="mt-5" style="font-size: 0.95em; color: #bbf;">
      Powered by <a href="https://api.nasa.gov/" target="_blank" style="color:#aaf;">NASA APOD API</a>
    </p>
  </div>
  <div id="audio-control" style="display:none;">
    <span id="audio-status">🔊</span>
    <span id="audio-label"></span>
  </div>
  <!-- Music (royalty-free) -->
  <audio id="birthday-audio" src="https://cdn.pixabay.com/audio/2022/07/26/audio_1237256e1b.mp3"></audio>
  <audio id="space-audio" src="https://cdn.pixabay.com/audio/2023/03/13/audio_128d3e2cfa.mp3"></audio>
  <!-- canvas-confetti CDN -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    // NASA API Key
    const NASA_API_KEY = "bhmqIUv5uNTAq7FahUCzeDUUMBcvs9qyjp7vHL04"; // <-- Replace with your API key!

    // Twinkling/falling stars animation
    (() => {
      const canvas = document.getElementById('star-canvas');
      const ctx = canvas.getContext('2d');
      let W = window.innerWidth, H = window.innerHeight;
      let stars = [];
      function resize() {
        W = window.innerWidth;
        H = window.innerHeight;
        canvas.width = W;
        canvas.height = H;
      }
      window.addEventListener('resize', resize);
      resize();
      // Create stars
      for (let i = 0; i < 120; i++) {
        stars.push({
          x: Math.random() * W,
          y: Math.random() * H,
          r: Math.random() * 2.5 + 0.5,
          s: Math.random() * 1.2 + 0.25,
          opacity: Math.random() * 0.7 + 0.3,
          twinkle: Math.random() * Math.PI * 2
        });
      }
      function draw() {
        ctx.clearRect(0, 0, W, H);
        for (let s of stars) {
          let twinkle = Math.sin(Date.now()/600 + s.twinkle) * 0.5 + 1.1;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r * twinkle, 0, 2 * Math.PI);
          ctx.fillStyle = `rgba(255,255,255,${s.opacity*twinkle})`;
          ctx.shadowColor = "#fff";
          ctx.shadowBlur = 10 * twinkle;
          ctx.fill();
        }
        update();
      }
      function update() {
        for (let s of stars) {
          s.y += s.s;
          if (s.y > H) {
            s.x = Math.random() * W;
            s.y = -6;
            s.r = Math.random() * 2.5 + 0.5;
            s.s = Math.random() * 1.2 + 0.25;
            s.opacity = Math.random() * 0.7 + 0.3;
            s.twinkle = Math.random() * Math.PI * 2;
          }
        }
      }
      setInterval(draw, 36);
    })();

    // Moon phase logic
    function moonPhase(dateStr) {
      const phaseEmoji = ["🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘"];
      const phaseName = [
        "New Moon","Waxing Crescent","First Quarter","Waxing Gibbous",
        "Full Moon","Waning Gibbous","Last Quarter","Waning Crescent"
      ];
      const d = new Date(dateStr);
      const year = d.getUTCFullYear();
      const month = d.getUTCMonth() + 1;
      const day = d.getUTCDate();
      let lp = 2551443;
      let now = Date.UTC(year,month-1,day,0,0,0)/1000;
      let new_moon = Date.UTC(1970,0,7,20,35,0)/1000;
      let phase = ((now - new_moon) % lp) / lp;
      let idx = Math.floor(phase * 8);
      if (idx < 0) idx += 8;
      return {emoji: phaseEmoji[idx], phase: phaseName[idx]};
    }

    // Space facts
    const spaceFacts = [
      "A day on Venus is longer than a year on Venus.",
      "Neutron stars can spin 600 times per second.",
      "Space is completely silent—no sound can travel in a vacuum.",
      "The footprints on the Moon will remain for millions of years.",
      "There are more stars in the universe than grains of sand on Earth.",
      "Jupiter has 79 known moons.",
      "The largest volcano in the solar system is Olympus Mons on Mars.",
      "Black holes aren’t actually 'holes'—they’re extremely dense objects.",
      "Saturn could float in water—it’s the only planet less dense than water.",
      "The sun is 400 times larger than the moon, but also 400 times farther from Earth.",
      "Mars appears red due to iron oxide (rust) on its surface.",
      "The International Space Station circles Earth every 90 minutes.",
      "Pluto is smaller than Earth’s moon.",
      "A spoonful of neutron star would weigh about a billion tons.",
      "There may be a planet made of diamond in our galaxy."
    ];

    function randomFact() {
      return spaceFacts[Math.floor(Math.random() * spaceFacts.length)];
    }

    // Confetti animation for birthday (canvas-confetti)
    function launchConfetti() {
      confetti({
        particleCount: 120,
        spread: 80,
        origin: { y: 0.5 },
        colors: ["#ffe066","#f7971e","#7f7fd5","#ff7f50","#fff"],
        shapes: ["circle","square"]
      });
      setTimeout(function(){
        confetti({
          particleCount: 70,
          angle: 140,
          spread: 50,
          origin: { x: 0, y: 0.7 },
          colors: ["#ffe066","#7f7fd5","#fff"],
        });
        confetti({
          particleCount: 70,
          angle: 40,
          spread: 50,
          origin: { x: 1, y: 0.7 },
          colors: ["#f7971e","#ff7f50","#fff"],
        });
      }, 500);
    }

    // Age calculation
    function getAge(birthDate, todayDate) {
      let years = todayDate.getFullYear() - birthDate.getFullYear();
      let m = todayDate.getMonth() - birthDate.getMonth();
      let d = todayDate.getDate() - birthDate.getDate();
      if (m<0 || (m===0 && d<0)) years--;
      return years;
    }

    // Music control (autoplay after button click)
    function playMusic(isBirthday) {
      let bdayAudio = document.getElementById('birthday-audio');
      let spaceAudio = document.getElementById('space-audio');
      let audioControl = document.getElementById('audio-control');
      if (isBirthday) {
        spaceAudio.pause();
        spaceAudio.currentTime = 0;
        bdayAudio.currentTime = 0;
        bdayAudio.volume = 0.7;
        bdayAudio.play();
        audioControl.style.display = 'flex';
        document.getElementById('audio-label').textContent = 'Birthday Song';
        document.getElementById('audio-status').textContent = '🎂';
        audioControl.onclick = () => {
          if (bdayAudio.paused) {
            bdayAudio.play();
            document.getElementById('audio-status').textContent = '🎂';
          } else {
            bdayAudio.pause();
            document.getElementById('audio-status').textContent = '⏸️';
          }
        }
      } else {
        bdayAudio.pause();
        bdayAudio.currentTime = 0;
        spaceAudio.currentTime = 0;
        spaceAudio.volume = 0.6;
        spaceAudio.play();
        audioControl.style.display = 'flex';
        document.getElementById('audio-label').textContent = 'Cosmic Ambience';
        document.getElementById('audio-status').textContent = '🪐';
        audioControl.onclick = () => {
          if (spaceAudio.paused) {
            spaceAudio.play();
            document.getElementById('audio-status').textContent = '🪐';
          } else {
            spaceAudio.pause();
            document.getElementById('audio-status').textContent = '⏸️';
          }
        }
      }
    }

    document.getElementById('go').onclick = async function() {
      const date = document.getElementById('birthday').value;
      if (!date) {
        document.getElementById('result').innerHTML = '<span class="error">Please select your birthday!</span>';
        return;
      }
      document.getElementById('result').innerHTML = '<div class="spinner-border text-light"></div>';
      // Birthday detection: only month and day
      const today = new Date();
      const inputDate = new Date(date);
      const isBirthday = (today.getMonth() === inputDate.getMonth()) && (today.getDate() === inputDate.getDate());
      try {
        const url = `https://api.nasa.gov/planetary/apod?api_key=${NASA_API_KEY}&date=${date}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.error || data.code === 400) {
          document.getElementById('result').innerHTML = `<span class="error">${data.msg || data.error.message || 'No image found for this date.'}</span>`;
          return;
        }
        let moon = moonPhase(date);
        let html = `<div id="result-card">`;
        if (isBirthday) {
          // Calculate age
          let age = getAge(inputDate, today);
          let candles = '';
          if (age > 0 && age < 30) {
            for (let i=0; i<Math.min(age,12); i++) candles += '<span class="candle-emoji">🕯️</span>';
          } else if (age >= 30 && age < 120) {
            candles = '<span class="candle-emoji">🕯️</span> x ' + age;
          }
          html += `
            <div class="bday-anim">🎉 Happy Birthday! 🎂</div>
            <div style="font-size:1.3em;margin-bottom:1em;">
              You are <b>${age}</b> years old! ${candles}
            </div>
          `;
          launchConfetti();
          playMusic(true);
        } else {
          playMusic(false);
        }
        if (data.media_type === "image" && data.url) {
          html += `<img src="${data.url}" alt="Space image for your birthday" class="mb-3"/><br>`;
        } else if (data.media_type === "video" && data.url) {
          html += `<div class="videoWrapper"><iframe src="${data.url}" frameborder="0" allowfullscreen></iframe></div>`;
        }
        if (data.title) html += `<h4>${data.title}</h4>`;
        if (data.explanation) html += `<p>${data.explanation}</p>`;
        html += `
          <div id="moon-phase" class="mb-2">
            ${moon.emoji} <span style="font-size:1.2em;">${moon.phase}</span>
          </div>
          <div style="font-size:1.1em; color:#cddcfe; margin-top:1em;">
            <b>Space Fact:</b> <span>${randomFact()}</span>
          </div>
        `;
        if (data.date) html += `<div style="margin-top:1em;"><small>Date: ${data.date}</small></div>`;
        html += `</div>`;
        document.getElementById('result').innerHTML = html;
      } catch (e) {
        document.getElementById('result').innerHTML = "<span class='error'>Could not fetch space info. Try another date!</span>";
      }
    }
  </script>
</body>
</html>